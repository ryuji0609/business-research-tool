<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Pro | è¦‹ç©æ›¸ãƒ»è«‹æ±‚æ›¸ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Outfit:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --blue: #0d47a1;
            --blue-light: #4facfe;
            --green: #06c755;
            --red: #e53e3e;
            --bg: #f0f4fd;
            --card: #ffffff;
            --text: #1a2b4c;
            --sub: #636e72;
            --border: #e2e8f0;
            --shadow: 0 4px 20px rgba(13, 71, 161, 0.08);
            --shadow-lg: 0 10px 40px rgba(13, 71, 161, 0.14);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* ===== NAV ===== */
        nav {
            background: linear-gradient(135deg, #0d47a1, #1565c0);
            color: white;
            padding: 1rem 5%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.15);
        }

        .nav-logo {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.5rem 1.2rem;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .nav-tab.active {
            background: white;
            color: var(--blue);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.25);
        }

        /* ===== SCREENS ===== */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ===== SECTION WRAPPER ===== */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 2rem 5%;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .card h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1.2rem;
            color: var(--blue);
            border-bottom: 2px solid var(--bg);
            padding-bottom: 0.6rem;
        }

        /* ===== FORMS ===== */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .form-group.full {
            grid-column: 1/-1;
        }

        label {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--sub);
        }

        input,
        textarea,
        select {
            border: 1.5px solid var(--border);
            border-radius: 8px;
            padding: 0.7rem 1rem;
            font-size: 0.95rem;
            font-family: 'Noto Sans JP', sans-serif;
            color: var(--text);
            transition: border 0.2s;
            background: white;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--blue-light);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 0.7rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Noto Sans JP', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--blue);
            color: white;
        }

        .btn-primary:hover {
            background: #1565c0;
            transform: translateY(-1px);
        }

        .btn-green {
            background: var(--green);
            color: white;
            box-shadow: 0 4px 12px rgba(6, 199, 85, 0.3);
        }

        .btn-green:hover {
            background: #05b34c;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--blue);
            border: 2px solid var(--blue);
        }

        .btn-outline:hover {
            background: var(--blue);
            color: white;
        }

        .btn-red {
            background: var(--red);
            color: white;
        }

        .btn-red:hover {
            background: #c53030;
        }

        .btn-sm {
            padding: 0.4rem 0.9rem;
            font-size: 0.82rem;
            border-radius: 7px;
        }

        .btn-save {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            margin-top: 1rem;
        }

        /* ===== PRESET ITEMS ===== */
        .preset-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .preset-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            background: var(--bg);
            border-radius: 10px;
            padding: 0.8rem 1rem;
        }

        .preset-item input {
            flex: 1;
            margin: 0;
        }

        .preset-item .price-input {
            max-width: 130px;
        }

        /* ===== DOCUMENT LIST ===== */
        .doc-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .doc-item {
            background: var(--card);
            border-radius: 12px;
            padding: 1.2rem 1.5rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--blue-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .doc-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-lg);
        }

        .doc-item.invoice-type {
            border-left-color: var(--green);
        }

        .doc-info h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
        }

        .doc-info p {
            font-size: 0.82rem;
            color: var(--sub);
        }

        .doc-badge {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            white-space: nowrap;
        }

        .badge-quote {
            background: rgba(79, 172, 254, 0.15);
            color: var(--blue);
        }

        .badge-invoice {
            background: rgba(6, 199, 85, 0.15);
            color: #059644;
        }

        .doc-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ===== EDITOR ===== */
        .editor-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .editor-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .doc-type-toggle {
            display: flex;
            background: var(--bg);
            border-radius: 10px;
            padding: 3px;
        }

        .doc-type-btn {
            padding: 0.4rem 1rem;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: var(--sub);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .doc-type-btn.active {
            background: white;
            color: var(--blue);
            box-shadow: var(--shadow);
        }

        /* ===== ITEMS TABLE ===== */
        .items-section h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--blue);
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        .items-table th {
            background: var(--bg);
            padding: 0.6rem 0.8rem;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--sub);
            text-align: left;
            border-bottom: 2px solid var(--border);
        }

        .items-table td {
            padding: 0.6rem 0.5rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .items-table input {
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.4rem 0.6rem;
            font-size: 0.9rem;
            width: 100%;
        }

        .qty-input {
            max-width: 60px;
            text-align: center;
        }

        .price-td {
            min-width: 130px;
        }

        .total-td {
            min-width: 110px;
            text-align: right;
            font-weight: 700;
        }

        .remove-row {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.2s;
        }

        .remove-row:hover {
            color: var(--red);
        }

        /* ===== PRESET PICKER ===== */
        .preset-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .preset-chip {
            background: rgba(13, 71, 161, 0.07);
            color: var(--blue);
            border: 1.5px solid rgba(13, 71, 161, 0.15);
            border-radius: 50px;
            padding: 0.35rem 0.9rem;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-chip:hover {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
        }

        /* ===== SUMMARY ===== */
        .summary-box {
            background: var(--bg);
            border-radius: 12px;
            padding: 1.2rem 1.5rem;
            margin-top: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.35rem 0;
            font-size: 0.95rem;
        }

        .summary-row.total {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--blue);
            border-top: 2px solid var(--border);
            margin-top: 0.5rem;
            padding-top: 0.7rem;
        }

        /* ===== PRINT PREVIEW ===== */
        #print-area {
            max-width: 800px;
            margin: 2rem auto;
            background: white;
            padding: 50px 60px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
        }

        .print-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        .print-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--blue);
            letter-spacing: 0.05em;
        }

        .print-doc-no {
            font-size: 0.85rem;
            color: var(--sub);
            margin-top: 6px;
        }

        .print-issuer {
            text-align: right;
        }

        .print-issuer h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .print-issuer p {
            font-size: 0.85rem;
            color: var(--sub);
            line-height: 1.7;
        }

        .print-client {
            margin-bottom: 30px;
        }

        .print-client p {
            font-size: 0.9rem;
            color: var(--sub);
            margin-bottom: 4px;
        }

        .print-client h3 {
            font-size: 1.3rem;
            font-weight: 700;
            border-bottom: 3px solid var(--blue);
            padding-bottom: 6px;
            display: inline-block;
        }

        .print-meta {
            display: flex;
            gap: 3rem;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        .print-meta span {
            color: var(--sub);
            font-size: 0.8rem;
            display: block;
            margin-bottom: 2px;
        }

        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .print-table th {
            background: var(--blue);
            color: white;
            padding: 0.7rem 1rem;
            font-size: 0.85rem;
            text-align: left;
        }

        .print-table td {
            padding: 0.7rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .print-table tr:nth-child(even) td {
            background: #f8faff;
        }

        .print-table .text-right {
            text-align: right;
        }

        .print-summary {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30px;
        }

        .print-summary-box {
            min-width: 280px;
        }

        .print-summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border);
        }

        .print-summary-total {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--blue);
            border-top: 2px solid var(--blue);
            border-bottom: none;
            margin-top: 4px;
            padding-top: 0.6rem;
        }

        .print-remarks {
            background: var(--bg);
            border-radius: 8px;
            padding: 1rem 1.2rem;
            font-size: 0.85rem;
            color: var(--sub);
            line-height: 1.8;
        }

        .print-remarks strong {
            color: var(--text);
            font-size: 0.88rem;
            display: block;
            margin-bottom: 4px;
        }

        /* ===== TOAST ===== */
        #toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1a2b4c;
            color: white;
            padding: 0.8rem 1.8rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: transform 0.3s ease;
            z-index: 9999;
            white-space: nowrap;
        }

        #toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* ===== EMPTY STATE ===== */
        .empty {
            text-align: center;
            padding: 3rem;
            color: var(--sub);
        }

        .empty span {
            font-size: 3rem;
            display: block;
            margin-bottom: 1rem;
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            body>* {
                display: none !important;
            }

            #print-modal {
                display: block !important;
                position: static !important;
                background: none !important;
                padding: 0 !important;
            }

            #print-area {
                box-shadow: none !important;
                margin: 0 !important;
                border-radius: 0 !important;
            }

            .no-print {
                display: none !important;
            }
        }

        /* ===== MODAL ===== */
        #print-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .modal-actions {
            max-width: 800px;
            margin: 0 auto 1rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        @media(max-width:640px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .print-meta {
                flex-direction: column;
                gap: 1rem;
            }

            #print-area {
                padding: 30px 20px;
            }

            .print-header {
                flex-direction: column;
                gap: 1rem;
            }

            .print-issuer {
                text-align: left;
            }
        }
    </style>
</head>

<body>

    <nav>
        <div class="nav-logo">ğŸ“„ Invoice Pro</div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showScreen('list')">ğŸ“‹ æ›¸é¡ä¸€è¦§</button>
            <button class="nav-tab" onclick="showScreen('editor')">âœï¸ æ–°è¦ä½œæˆ</button>
            <button class="nav-tab" onclick="showScreen('settings')">âš™ï¸ è¨­å®š</button>
        </div>
    </nav>

    <!-- ========== LIST SCREEN ========== -->
    <div id="screen-list" class="screen active">
        <div class="container">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;">
                <div class="page-title" style="margin:0">æ›¸é¡ä¸€è¦§</div>
                <button class="btn btn-primary" onclick="newDocument()">ï¼‹ æ–°è¦ä½œæˆ</button>
            </div>
            <div id="doc-list" class="doc-list">
                <div class="empty"><span>ğŸ“‚</span>æ›¸é¡ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“<br><small>ã€Œæ–°è¦ä½œæˆã€ã‹ã‚‰è¦‹ç©æ›¸ã‚’ä½œã‚Šã¾ã—ã‚‡ã†</small></div>
            </div>
        </div>
    </div>

    <!-- ========== EDITOR SCREEN ========== -->
    <div id="screen-editor" class="screen">
        <div class="container">
            <div class="editor-header">
                <button class="btn btn-outline btn-sm" onclick="showScreen('list')">â† ä¸€è¦§ã¸</button>
                <div class="editor-title" id="editor-title">æ–°è¦æ›¸é¡</div>
                <div class="doc-type-toggle">
                    <button class="doc-type-btn active" id="btn-quote" onclick="setDocType('è¦‹ç©æ›¸')">è¦‹ç©æ›¸</button>
                    <button class="doc-type-btn" id="btn-invoice" onclick="setDocType('è«‹æ±‚æ›¸')">è«‹æ±‚æ›¸</button>
                </div>
            </div>

            <!-- å®›å…ˆï¼†æ—¥ä»˜ -->
            <div class="card">
                <h3>ğŸ“‹ åŸºæœ¬æƒ…å ±</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>å®›å…ˆï¼ˆä¼šç¤¾åãƒ»æ‹…å½“è€…åï¼‰</label>
                        <input type="text" id="client-name" placeholder="æ ªå¼ä¼šç¤¾ã€‡ã€‡ æ‹…å½“ å±±ç”°æ§˜">
                    </div>
                    <div class="form-group">
                        <label>æ›¸é¡ç•ªå·</label>
                        <input type="text" id="doc-number" placeholder="ä¾‹: EST-2024-001">
                    </div>
                    <div class="form-group">
                        <label>ç™ºè¡Œæ—¥</label>
                        <input type="date" id="doc-date">
                    </div>
                    <div class="form-group">
                        <label>æœ‰åŠ¹æœŸé™ / æ”¯æ‰•æœŸé™</label>
                        <input type="date" id="doc-due">
                    </div>
                    <div class="form-group full">
                        <label>ä»¶å</label>
                        <input type="text" id="doc-subject" placeholder="ä¾‹: Webã‚µã‚¤ãƒˆåˆ¶ä½œã®ã”ææ¡ˆ">
                    </div>
                </div>
            </div>

            <!-- é …ç›® -->
            <div class="card">
                <h3>ğŸ’° é …ç›®</h3>
                <!-- ç¨åŒºåˆ† -->
                <div style="display:flex;align-items:center;gap:0.8rem;margin-bottom:1rem;flex-wrap:wrap;">
                    <span style="font-size:0.82rem;font-weight:700;color:var(--sub);">ç¨åŒºåˆ†ï¼š</span>
                    <div class="doc-type-toggle" id="tax-toggle">
                        <button class="doc-type-btn active" id="tax-btn-soto"
                            onclick="setTaxType('å¤–ç¨')">å¤–ç¨ï¼ˆ10%ï¼‰</button>
                        <button class="doc-type-btn" id="tax-btn-nai" onclick="setTaxType('å†…ç¨')">å†…ç¨ï¼ˆç¨è¾¼ï¼‰</button>
                        <button class="doc-type-btn" id="tax-btn-hi" onclick="setTaxType('éèª²ç¨')">éèª²ç¨</button>
                    </div>
                </div>
                <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆ & æœ€è¿‘ä½¿ã£ãŸé …ç›® -->
                <div id="preset-picker" class="preset-picker"></div>
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>é …ç›®å</th>
                            <th style="width:60px">æ•°é‡</th>
                            <th style="width:130px">å˜ä¾¡</th>
                            <th style="width:110px;text-align:right">é‡‘é¡</th>
                            <th style="width:36px"></th>
                        </tr>
                    </thead>
                    <tbody id="items-body"></tbody>
                </table>
                <button class="btn btn-outline btn-sm" onclick="addItem()">ï¼‹ è¡Œã‚’è¿½åŠ </button>

                <div class="summary-box">
                    <div class="summary-row" id="row-subtotal"><span>å°è¨ˆ</span><span id="sub-total">Â¥0</span></div>
                    <div class="summary-row" id="row-tax"><span id="tax-label">æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰</span><span
                            id="tax-total">Â¥0</span></div>
                    <div class="summary-row total"><span id="grand-label">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</span><span id="grand-total">Â¥0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å‚™è€ƒ -->
        <div class="card">
            <h3>ğŸ“ å‚™è€ƒ</h3>
            <textarea id="doc-remarks" rows="4" placeholder="æŒ¯è¾¼å…ˆã‚„æ”¯æ‰•ã„æ¡ä»¶ãªã©â€¦"></textarea>
        </div>

        <!-- Save buttons -->
        <div style="display:flex;gap:1rem;flex-wrap:wrap;">
            <button class="btn btn-primary btn-save" style="flex:1" onclick="saveDocument()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
            <button class="btn btn-green btn-save" style="flex:1" onclick="previewDocument()">ğŸ–¨ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»PDF</button>
        </div>
    </div>
    </div>

    <!-- ========== SETTINGS SCREEN ========== -->
    <div id="screen-settings" class="screen">
        <div class="container">
            <div class="page-title">âš™ï¸ è¨­å®š</div>

            <!-- è‡ªåˆ†ã®æƒ…å ± -->
            <div class="card">
                <h3>ğŸ‘¤ ç™ºè¡Œè€…æƒ…å ±ï¼ˆ1å›ã ã‘è¨­å®šï¼‰</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>åå‰ / å±‹å·</label>
                        <input type="text" id="s-name" placeholder="ryuji / ã€‡ã€‡ãƒ‡ã‚¶ã‚¤ãƒ³">
                    </div>
                    <div class="form-group">
                        <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                        <input type="email" id="s-email" placeholder="hello@example.com">
                    </div>
                    <div class="form-group">
                        <label>é›»è©±ç•ªå·</label>
                        <input type="tel" id="s-tel" placeholder="090-0000-0000">
                    </div>
                    <div class="form-group">
                        <label>ä½æ‰€ï¼ˆçœç•¥å¯ï¼‰</label>
                        <input type="text" id="s-address" placeholder="æ±äº¬éƒ½æ¸‹è°·åŒº...">
                    </div>
                    <div class="form-group full">
                        <label>æŒ¯è¾¼å…ˆï¼ˆå‚™è€ƒæ¬„ã«è‡ªå‹•æŒ¿å…¥ã•ã‚Œã¾ã™ï¼‰</label>
                        <textarea id="s-bank" rows="3"
                            placeholder="ã€‡ã€‡éŠ€è¡Œ ã€‡ã€‡æ”¯åº—&#10;æ™®é€š 1234567&#10;å£åº§åç¾©: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦"></textarea>
                    </div>
                </div>
            </div>

            <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆé …ç›® -->
            <div class="card">
                <h3>âš¡ ã‚ˆãä½¿ã†é …ç›®ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰</h3>
                <div id="preset-list" class="preset-list"></div>
                <button class="btn btn-outline btn-sm" style="margin-top:1rem" onclick="addPreset()">ï¼‹ é …ç›®ã‚’è¿½åŠ </button>
            </div>

            <button class="btn btn-primary btn-save" onclick="saveSettings()">âœ… è¨­å®šã‚’ä¿å­˜</button>
        </div>
    </div>

    <!-- ========== PRINT MODAL ========== -->
    <div id="print-modal">
        <div class="modal-actions no-print">
            <button class="btn btn-outline" onclick="closePrintModal()">â† æˆ»ã‚‹</button>
            <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ PDFã§ä¿å­˜</button>
            <button class="btn btn-green" onclick="convertToInvoice()" id="convert-btn">è«‹æ±‚æ›¸ã«å¤‰æ›</button>
        </div>
        <div id="print-area"></div>
    </div>

    <div id="toast">âœ… ä¿å­˜ã—ã¾ã—ãŸ</div>

    <script>
        // ===== STATE =====
        let currentDocId = null;
        let currentDocType = 'è¦‹ç©æ›¸';
        let currentTaxType = 'å¤–ç¨'; // å¤–ç¨ | å†…ç¨ | éèª²ç¨

        // ===== STORAGE HELPERS =====
        const getSettings = () => JSON.parse(localStorage.getItem('inv_settings') || '{"name":"","email":"","tel":"","address":"","bank":"","presets":[]}');
        const getDocs = () => JSON.parse(localStorage.getItem('inv_docs') || '[]');
        const saveDocs = d => localStorage.setItem('inv_docs', JSON.stringify(d));

        // ===== INIT =====
        window.onload = () => {
            loadSettings();
            renderDocList();
            initEditor();
            // Set today as default date
            document.getElementById('doc-date').valueAsDate = new Date();
        };

        // ===== SCREEN NAVIGATION =====
        function showScreen(name) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('screen-' + name).classList.add('active');
            const idx = { list: 0, editor: 1, settings: 2 }[name];
            document.querySelectorAll('.nav-tab')[idx].classList.add('active');
            if (name === 'list') renderDocList();
        }

        // ===== DOC TYPE TOGGLE =====
        function setDocType(type) {
            currentDocType = type;
            document.getElementById('btn-quote').className = 'doc-type-btn' + (type === 'è¦‹ç©æ›¸' ? ' active' : '');
            document.getElementById('btn-invoice').className = 'doc-type-btn' + (type === 'è«‹æ±‚æ›¸' ? ' active' : '');
        }

        // ===== EDITOR INIT =====
        function initEditor() {
            if (!document.querySelector('#items-body tr')) addItem();
            renderPresetPicker();
        }

        // ===== TAX TYPE =====
        function setTaxType(type) {
            currentTaxType = type;
            ['å¤–ç¨', 'å†…ç¨', 'éèª²ç¨'].forEach(t => {
                const key = { å¤–ç¨: 'soto', å†…ç¨: 'nai', éèª²ç¨: 'hi' }[t];
                document.getElementById('tax-btn-' + key).className = 'doc-type-btn' + (t === type ? ' active' : '');
            });
            updateTotals();
        }

        function newDocument() {
            currentDocId = null;
            currentDocType = 'è¦‹ç©æ›¸';
            currentTaxType = 'å¤–ç¨';
            document.getElementById('editor-title').textContent = 'æ–°è¦æ›¸é¡';
            document.getElementById('client-name').value = '';
            document.getElementById('doc-number').value = 'EST-' + Date.now().toString().slice(-6);
            document.getElementById('doc-date').valueAsDate = new Date();
            document.getElementById('doc-due').value = '';
            document.getElementById('doc-subject').value = '';
            document.getElementById('doc-remarks').value = getSettings().bank || '';
            document.getElementById('items-body').innerHTML = '';
            addItem();
            setDocType('è¦‹ç©æ›¸');
            setTaxType('å¤–ç¨');
            updateTotals();
            renderPresetPicker();
            showScreen('editor');
        }

        function editDocument(id) {
            const d = getDocs().find(x => x.id === id);
            if (!d) return;
            currentDocId = id;
            currentDocType = d.type;
            document.getElementById('editor-title').textContent = d.type + 'ã‚’ç·¨é›†';
            document.getElementById('client-name').value = d.client || '';
            document.getElementById('doc-number').value = d.number || '';
            document.getElementById('doc-date').value = d.date || '';
            document.getElementById('doc-due').value = d.due || '';
            document.getElementById('doc-subject').value = d.subject || '';
            document.getElementById('doc-remarks').value = d.remarks || '';
            const tbody = document.getElementById('items-body');
            tbody.innerHTML = '';
            (d.items || []).forEach(item => addItem(item));
            setDocType(d.type);
            setTaxType(d.taxType || 'å¤–ç¨');
            updateTotals();
            renderPresetPicker();
            showScreen('editor');
        }

        // ===== ITEMS =====
        function addItem(data = {}) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
      <td><input type="text" placeholder="é …ç›®å" value="${data.name || ''}" oninput="updateTotals()"></td>
      <td><input type="number" class="qty-input" value="${data.qty || 1}" min="1" oninput="updateTotals()"></td>
      <td class="price-td"><input type="number" placeholder="0" value="${data.price || ''}" oninput="updateTotals()"></td>
      <td class="total-td"><span class="item-total">Â¥0</span></td>
      <td><button class="remove-row" onclick="this.closest('tr').remove();updateTotals()">Ã—</button></td>
    `;
            document.getElementById('items-body').appendChild(tr);
            updateTotals();
        }

        function getItems() {
            return [...document.querySelectorAll('#items-body tr')].map(tr => {
                const inputs = tr.querySelectorAll('input');
                return { name: inputs[0].value, qty: parseInt(inputs[1].value) || 1, price: parseFloat(inputs[2].value) || 0 };
            });
        }

        function updateTotals() {
            let sub = 0;
            document.querySelectorAll('#items-body tr').forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                const qty = parseInt(inputs[1].value) || 1;
                const price = parseFloat(inputs[2].value) || 0;
                const t = qty * price;
                tr.querySelector('.item-total').textContent = 'Â¥' + t.toLocaleString();
                sub += t;
            });
            const taxRow = document.getElementById('row-tax');
            const taxLabel = document.getElementById('tax-label');
            const grandLabel = document.getElementById('grand-label');
            if (currentTaxType === 'å¤–ç¨') {
                const tax = Math.round(sub * 0.10);
                taxRow.style.display = '';
                taxLabel.textContent = 'æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰';
                grandLabel.textContent = 'åˆè¨ˆï¼ˆç¨è¾¼ï¼‰';
                document.getElementById('sub-total').textContent = 'Â¥' + sub.toLocaleString();
                document.getElementById('tax-total').textContent = 'Â¥' + tax.toLocaleString();
                document.getElementById('grand-total').textContent = 'Â¥' + (sub + tax).toLocaleString();
            } else if (currentTaxType === 'å†…ç¨') {
                const tax = Math.round(sub * 10 / 110);
                taxRow.style.display = '';
                taxLabel.textContent = 'å†…æ¶ˆè²»ç¨ï¼ˆ10%ç›¸å½“ï¼‰';
                grandLabel.textContent = 'åˆè¨ˆï¼ˆç¨è¾¼ï¼‰';
                document.getElementById('sub-total').textContent = 'Â¥' + sub.toLocaleString();
                document.getElementById('tax-total').textContent = 'Â¥' + tax.toLocaleString();
                document.getElementById('grand-total').textContent = 'Â¥' + sub.toLocaleString();
            } else { // éèª²ç¨
                taxRow.style.display = 'none';
                grandLabel.textContent = 'åˆè¨ˆ';
                document.getElementById('sub-total').textContent = 'Â¥' + sub.toLocaleString();
                document.getElementById('grand-total').textContent = 'Â¥' + sub.toLocaleString();
            }
        }

        // ===== PRESET PICKER =====
        function getRecentItems() {
            const all = {};
            getDocs().forEach(d => {
                (d.items || []).filter(i => i.name && i.price).forEach(i => {
                    const key = i.name + '_' + i.price;
                    if (!all[key]) all[key] = { name: i.name, price: i.price, count: 0 };
                    all[key].count++;
                });
            });
            return Object.values(all).sort((a, b) => b.count - a.count).slice(0, 8);
        }

        function renderPresetPicker() {
            const s = getSettings();
            const recent = getRecentItems();
            const picker = document.getElementById('preset-picker');
            const presetChips = (s.presets || []).map(p =>
                `<div class="preset-chip" onclick="addItem({name:'${p.name}',qty:1,price:${p.price}})">âš¡ ${p.name}ï¼ˆÂ¥${parseInt(p.price).toLocaleString()}ï¼‰</div>`
            ).join('');
            const recentChips = recent.length ? '<span style="font-size:0.78rem;color:var(--sub);font-weight:600;align-self:center;">æœ€è¿‘ï¼š</span>' + recent.map(p =>
                `<div class="preset-chip" style="background:rgba(6,199,85,0.08);border-color:rgba(6,199,85,0.25);color:#059644" onclick="addItem({name:'${p.name}',qty:1,price:${p.price}})">ğŸ• ${p.name}ï¼ˆÂ¥${parseInt(p.price).toLocaleString()}ï¼‰</div>`
            ).join('') : '';
            picker.innerHTML = presetChips + recentChips;
            if (!picker.innerHTML) picker.innerHTML = '<span style="font-size:0.82rem;color:var(--sub);">âš™ï¸è¨­å®šã§ãƒ—ãƒªã‚»ãƒƒãƒˆé …ç›®ã‚’ç™»éŒ²ã™ã‚‹ã¨ã€ã“ã“ã«ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</span>';
        }

        // ===== SAVE / LOAD DOCS =====
        function saveDocument() {
            const doc = {
                id: currentDocId || 'doc_' + Date.now(),
                type: currentDocType,
                taxType: currentTaxType,
                client: document.getElementById('client-name').value,
                number: document.getElementById('doc-number').value,
                date: document.getElementById('doc-date').value,
                due: document.getElementById('doc-due').value,
                subject: document.getElementById('doc-subject').value,
                remarks: document.getElementById('doc-remarks').value,
                items: getItems(),
                updatedAt: new Date().toISOString()
            };
            let docs = getDocs();
            const idx = docs.findIndex(d => d.id === doc.id);
            if (idx >= 0) docs[idx] = doc; else docs.unshift(doc);
            saveDocs(docs);
            currentDocId = doc.id;
            showToast('âœ… ä¿å­˜ã—ã¾ã—ãŸ');
        }

        function renderDocList() {
            const docs = getDocs();
            const el = document.getElementById('doc-list');
            if (docs.length === 0) {
                el.innerHTML = '<div class="empty"><span>ğŸ“‚</span>æ›¸é¡ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“<br><small>ã€Œæ–°è¦ä½œæˆã€ã‹ã‚‰è¦‹ç©æ›¸ã‚’ä½œã‚Šã¾ã—ã‚‡ã†</small></div>';
                return;
            }
            el.innerHTML = docs.map(d => {
                const sub = (d.items || []).reduce((a, i) => a + i.qty * i.price, 0);
                const total = sub + Math.round(sub * 0.1);
                return `<div class="doc-item ${d.type === 'è«‹æ±‚æ›¸' ? 'invoice-type' : ''}" onclick="editDocument('${d.id}')">
        <div class="doc-info">
          <h4>${d.subject || 'ï¼ˆä»¶åãªã—ï¼‰'}</h4>
          <p>${d.client || 'å®›å…ˆæœªè¨­å®š'} ï¼ ${d.date || ''} ï¼ åˆè¨ˆ Â¥${total.toLocaleString()}</p>
        </div>
        <div style="display:flex;align-items:center;gap:0.8rem">
          <span class="doc-badge ${d.type === 'è«‹æ±‚æ›¸' ? 'badge-invoice' : 'badge-quote'}">${d.type}</span>
          <div class="doc-actions" onclick="event.stopPropagation()">
            <button class="btn btn-outline btn-sm" onclick="previewDoc('${d.id}')">ğŸ–¨ï¸</button>
            <button class="btn btn-red btn-sm" onclick="deleteDoc('${d.id}')">å‰Šé™¤</button>
          </div>
        </div>
      </div>`;
            }).join('');
        }

        function deleteDoc(id) {
            if (!confirm('ã“ã®æ›¸é¡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            saveDocs(getDocs().filter(d => d.id !== id));
            renderDocList();
            showToast('ğŸ—‘ï¸ å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // ===== PREVIEW / PDF =====
        function previewDocument() {
            saveDocument();
            openPreview(currentDocId);
        }

        function previewDoc(id) {
            openPreview(id);
        }

        function openPreview(id) {
            const d = getDocs().find(x => x.id === id);
            if (!d) return;
            const s = getSettings();
            const taxType = d.taxType || 'å¤–ç¨';
            const sub = (d.items || []).reduce((a, i) => a + i.qty * i.price, 0);
            let tax = 0, total = sub, taxLine = '';
            if (taxType === 'å¤–ç¨') {
                tax = Math.round(sub * 0.10);
                total = sub + tax;
                taxLine = `<div class="print-summary-row"><span>æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰</span><span>Â¥${tax.toLocaleString()}</span></div>`;
            } else if (taxType === 'å†…ç¨') {
                tax = Math.round(sub * 10 / 110);
                total = sub;
                taxLine = `<div class="print-summary-row"><span>å†…æ¶ˆè²»ç¨ï¼ˆ10%ç›¸å½“ï¼‰</span><span>Â¥${tax.toLocaleString()}</span></div>`;
            }
            const grandLabel = taxType === 'éèª²ç¨' ? 'åˆè¨ˆ' : 'åˆè¨ˆï¼ˆç¨è¾¼ï¼‰';

            const rows = (d.items || []).filter(i => i.name).map(i => `
      <tr>
        <td>${i.name}</td>
        <td class="text-right">${i.qty}</td>
        <td class="text-right">Â¥${i.price.toLocaleString()}</td>
        <td class="text-right">Â¥${(i.qty * i.price).toLocaleString()}</td>
      </tr>
    `).join('');

            const convertBtn = document.getElementById('convert-btn');
            convertBtn.style.display = d.type === 'è¦‹ç©æ›¸' ? 'inline-flex' : 'none';
            convertBtn.setAttribute('data-id', id);

            document.getElementById('print-area').innerHTML = `
      <div class="print-header">
        <div>
          <div class="print-title">${d.type}</div>
          <div class="print-doc-no">æ›¸é¡ç•ªå·ï¼š${d.number || '-'}</div>
        </div>
        <div class="print-issuer">
          <h4>${s.name || ''}</h4>
          <p>${s.address || ''}<br>${s.tel || ''}<br>${s.email || ''}</p>
        </div>
      </div>
      <div class="print-client">
        <p>ä»¥ä¸‹ã®é€šã‚Šã€${d.type === 'è¦‹ç©æ›¸' ? 'ãŠè¦‹ç©ã‚‚ã‚Š' : 'ã”è«‹æ±‚'}ç”³ã—ä¸Šã’ã¾ã™ã€‚</p>
        <h3>${d.client || ''} å¾¡ä¸­</h3>
      </div>
      <div class="print-meta">
        <div><span>${d.type === 'è¦‹ç©æ›¸' ? 'è¦‹ç©' : 'ç™ºè¡Œ'}æ—¥</span>${d.date || '-'}</div>
        <div><span>${d.type === 'è¦‹ç©æ›¸' ? 'æœ‰åŠ¹æœŸé™' : 'ãŠæ”¯æ‰•æœŸé™'}</span>${d.due || '-'}</div>
        <div><span>ä»¶å</span>${d.subject || '-'}</div>
      </div>
      <table class="print-table">
        <thead><tr><th>å“ç›®</th><th class="text-right">æ•°é‡</th><th class="text-right">å˜ä¾¡</th><th class="text-right">é‡‘é¡</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
      <div class="print-summary">
        <div class="print-summary-box">
          <div class="print-summary-row"><span>å°è¨ˆ</span><span>Â¥${sub.toLocaleString()}</span></div>
          ${taxLine}
          <div class="print-summary-row print-summary-total"><span>${grandLabel}</span><span>Â¥${total.toLocaleString()}</span></div>
        </div>
      </div>
      ${d.remarks ? `<div class="print-remarks"><strong>å‚™è€ƒ</strong>${d.remarks.replace(/\n/g, '<br>')}</div>` : ''}
    `;

            document.getElementById('print-modal').style.display = 'block';
        }

        function closePrintModal() {
            document.getElementById('print-modal').style.display = 'none';
        }

        function convertToInvoice() {
            const id = document.getElementById('convert-btn').getAttribute('data-id');
            let docs = getDocs();
            const idx = docs.findIndex(d => d.id === id);
            if (idx < 0) return;
            docs[idx].type = 'è«‹æ±‚æ›¸';
            docs[idx].number = docs[idx].number.replace('EST-', 'INV-');
            docs[idx].date = new Date().toISOString().slice(0, 10);
            saveDocs(docs);
            showToast('ğŸ‰ è«‹æ±‚æ›¸ã«å¤‰æ›ã—ã¾ã—ãŸ');
            closePrintModal();
            openPreview(id);
            renderDocList();
        }

        // ===== SETTINGS =====
        function loadSettings() {
            const s = getSettings();
            document.getElementById('s-name').value = s.name || '';
            document.getElementById('s-email').value = s.email || '';
            document.getElementById('s-tel').value = s.tel || '';
            document.getElementById('s-address').value = s.address || '';
            document.getElementById('s-bank').value = s.bank || '';
            renderPresetSettingsList(s.presets || []);
        }

        function saveSettings() {
            const presets = [...document.querySelectorAll('.preset-item')].map(el => ({
                name: el.querySelectorAll('input')[0].value,
                price: el.querySelectorAll('input')[1].value
            })).filter(p => p.name);

            const s = {
                name: document.getElementById('s-name').value,
                email: document.getElementById('s-email').value,
                tel: document.getElementById('s-tel').value,
                address: document.getElementById('s-address').value,
                bank: document.getElementById('s-bank').value,
                presets
            };
            localStorage.setItem('inv_settings', JSON.stringify(s));
            showToast('âœ… è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            renderPresetPicker();
        }

        function renderPresetSettingsList(presets) {
            document.getElementById('preset-list').innerHTML = presets.map(p => `
      <div class="preset-item">
        <input type="text" placeholder="é …ç›®åï¼ˆä¾‹: LPåˆ¶ä½œï¼‰" value="${p.name}">
        <input type="number" class="price-input" placeholder="å˜ä¾¡" value="${p.price}">
        <button class="btn btn-red btn-sm" onclick="this.closest('.preset-item').remove()">å‰Šé™¤</button>
      </div>
    `).join('');
        }

        function addPreset() {
            const div = document.createElement('div');
            div.className = 'preset-item';
            div.innerHTML = `
      <input type="text" placeholder="é …ç›®åï¼ˆä¾‹: LPåˆ¶ä½œï¼‰">
      <input type="number" class="price-input" placeholder="å˜ä¾¡">
      <button class="btn btn-red btn-sm" onclick="this.closest('.preset-item').remove()">å‰Šé™¤</button>
    `;
            document.getElementById('preset-list').appendChild(div);
        }

        // ===== TOAST =====
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2500);
        }
    </script>
</body>

</html>